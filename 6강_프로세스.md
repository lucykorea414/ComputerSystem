# 6ê°•) í”„ë¡œì„¸ìŠ¤

## í”„ë¡œì„¸ìŠ¤ì˜ ê°œë…

- â€œProcess is a program in executionâ€
- í”„ë¡œì„¸ìŠ¤ì˜ ë¬¸ë§¥(context)
    - CPU ìˆ˜í–‰ ìƒíƒœë¥¼ ë‚˜íƒ€ë‚´ëŠ” í•˜ë“œì›¨ì–´ ë¬¸ë§¥
        - Program Counter
        - ê°ì¢… register
    - í”„ë¡œì„¸ìŠ¤ì˜ ì£¼ì†Œ ê³µê°„
        - code, data, stack
    - í”„ë¡œì„¸ìŠ¤ ê´€ë ¨ ì»¤ë„ ìë£Œ êµ¬ì¡°
        - PCB (Process Control Block)
        - Kernal stack
        

![Untitled](image/6á„€á…¡á†¼/Untitled.png)

## í”„ë¡œì„¸ìŠ¤ì˜ ìƒíƒœ (Process State)

- í”„ë¡œì„¸ìŠ¤ëŠ” ìƒíƒœ(state)ê°€ ë³€ê²½ë˜ë©° ìˆ˜í–‰ëœë‹¤
    - Running
        - CPUë¥¼ ì¡ê³  instructionì„ ìˆ˜í–‰ì¤‘ì¸ ìƒíƒœ
    - Ready
        - CPUë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ìƒíƒœ(ë©”ëª¨ë¦¬ ë“± ë‹¤ë¥¸ ì¡°ê±´ì„ ëª¨ë‘ ë§Œì¡±í•˜ê³ )
    - Blocked (wait, sleep)
        - CPUë¥¼ ì£¼ì–´ë„ ë‹¹ì¥ instructionì„ ìˆ˜í–‰í•  ìˆ˜ ì—†ëŠ” ìƒíƒœ
        - Process ìì‹ ì´ ìš”ì²­í•œ event(ì˜ˆ: I/O)ê°€ ì¦‰ì‹œ ë§Œì¡±ë˜ì§€ ì•Šì•„ ì´ë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ìƒíƒœ
        - ex) ë””ìŠ¤í¬ì—ì„œ fileì„ ì½ì–´ì™€ì•¼ í•˜ëŠ” ê²½ìš°
    - New
        - í”„ë¡œì„¸ìŠ¤ê°€ ìƒì„±ì¤‘ì¸ ìƒíƒœ
    - Terminated
        - ìˆ˜í–‰(execution)ì´ ëë‚œ ìƒíƒœ

## í”„ë¡œì„¸ìŠ¤ ìƒíƒœë„

![Untitled1](image/6ê°•/Untitled1.png)

â†’ admit: ë©”ëª¨ë¦¬ì— ì˜¬ë¼ê°ˆ ê²ƒì´ëƒ, ì•ˆì˜¬ë¼ê°ˆ ê²ƒì´ëƒë¥¼ ê²°ì •í•´ì¤Œ (ì¥ê¸° ìŠ¤ì¼€ì¤„ëŸ¬ê°€ í•˜ëŠ” ì¼!)

## í”„ë¡œì„¸ìŠ¤ì˜ ìƒíƒœ

![Untitled2](image/6ê°•/Untitled2.png)

â†’ í•˜ë“œì›¨ì–´ì—ë„ ê°ê° queueê°€ ì¡´ì¬í•¨

![Untitled3](image/6ê°•/Untitled3.png)

â†’ Kernel Address spaceì˜ ë°ì´í„° ì˜ì—­: ìš´ì˜ì²´ì œì˜ ì»¤ë„ì´ ìì‹ ì˜ ë°ì´í„° ì˜ì—­ì— ìë£Œêµ¬ì¡°ë¡œ ê°ê°ì˜ queueë¥¼ ë§Œë“¤ì–´ì„œ ê´€ë¦¬ í•¨

â†’ ì´ë•Œ ready ìƒíƒœì¸ íì—ëŠ” CPUê¶Œí•œì„ ì£¼ê²Œ ë˜ê³ , blocked ëœ ìƒíƒœëŠ” ê¶Œí•œì„ ì£¼ì§€ ì•Šê³ 

## Process Control Block (PCB)

- ìš´ì˜ì²´ì œê°€ ê° í”„ë¡œì„¸ìŠ¤ë¥¼ ê´€ë¦¬í•˜ê¸° ìœ„í•´ í”„ë¡œì„¸ìŠ¤ë‹¹ ìœ ì§€í•˜ëŠ” ì •ë³´
    
    â†’ ê°ê°ì˜ í”„ë¡œì„¸ìŠ¤ì— ëŒ€í•œ ì •ë³´ê°€ ìˆëŠ” ìë£Œêµ¬ì¡°
    

- êµ¬ì„± ìš”ì†Œ (êµ¬ì¡°ì²´ë¡œ ìœ ì§€)
    1. OSê°€ ê´€ë¦¬ìƒ ì‚¬ìš©í•˜ëŠ” ì •ë³´
        - Process state, Process ID (process number)
        - scheduling information, priority
    2. CPU ìˆ˜í–‰ ê´€ë ¨ í•˜ë“œì›¨ì–´ ê°’
        - Program counter, registers
    3. ë©”ëª¨ë¦¬ ê´€ë ¨
        - Code, data, stackì˜ ìœ„ì¹˜ ì •ë³´
    4. íŒŒì¼ ê´€ë ¨
        - Open file descriptorsâ€¦

![Untitled4](image/6ê°•/Untitled4.png)

## ë¬¸ë§¥ êµí™˜ (Context Switch)

- CPUë¥¼ í•œ í”„ë¡œì„¸ìŠ¤ì—ì„œ ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ë¡œ ë„˜ê²¨ì£¼ëŠ” ê³¼ì •
- CPUê°€ ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ì—ê²Œ ë„˜ì–´ê°ˆ ë•Œ ìš´ì˜ì²´ì œëŠ” ë‹¤ìŒì„ ìˆ˜í–‰
    - CPUë¥¼ ë‚´ì–´ì£¼ëŠ” í”„ë¡œì„¸ìŠ¤ì˜ ìƒíƒœë¥¼ ê·¸ í”„ë¡œì„¸ìŠ¤ì˜ PCBì— ì €ì¥
    - CPUë¥¼ ìƒˆë¡­ê²Œ ì–»ëŠ” í”„ë¡œì„¸ìŠ¤ì˜ ìƒíƒœë¥¼ PCBì—ì„œ ì½ì–´ì˜´

![Untitled5](image/6ê°•/Untitled5.png)

- System callì´ë‚˜ Interrupt ë°œìƒì‹œ ë°˜ë“œì‹œ context switchê°€ ì¼ì–´ë‚˜ëŠ” ê²ƒì€ ì•„ë‹˜
(ëŒ€ë¶€ë¶„ì€ ë¬¸ë§¥êµí™˜ì´ ì¼ì–´ë‚¨)

![Untitled6](image/6ê°•/Untitled6.png)

```
(1)ì˜ ê²½ìš°ì—ë„ CPU ìˆ˜í–‰ ì •ë³´ ë“± contextì˜ ì¼ë¶€ë¥¼ PCBì— saveí•´ì•¼ í•˜ì§€ë§Œ ë¬¸ë§¥êµí™˜ì„ í•˜ëŠ” (2)ì˜ ê²½ìš°
ê·¸ ë¶€ë‹´ì´ í›¨ì”¬ í¼ (ì˜¤ë² í—¤ë“œê°€ ê±¸ë¦¬ê¸° ë•Œë¬¸)
	eg. cache memory flush
```

## í”„ë¡œì„¸ìŠ¤ë¥¼ ìŠ¤ì¼€ì¤„ë§í•˜ê¸° ìœ„í•œ í

- Job Queue
    - í˜„ì¬ ì‹œìŠ¤í…œ ë‚´ì— ìˆëŠ” ëª¨ë“  í”„ë¡œì„¸ìŠ¤ì˜ ì§‘í•©
- Ready Queue
    - í˜„ì¬ ë©”ëª¨ë¦¬ ë‚´ì— ìˆìœ¼ë©´ì„œ CPUë¥¼ ì¡ì•„ì„œ ì‹¤í–‰ë˜ê¸°ë¥¼ ê¸°ë‹¤ë¦¬ëŠ” í”„ë¡œì„¸ìŠ¤ì˜ ì§‘í•©
- Device Queues
    - I/O ë””ë°”ì´ìŠ¤ì˜ ì²˜ë¦¬ë¥¼ ê¸°ë‹¤ë¦¬ëŠ” í”„ë¡œì„¸ìŠ¤ì˜ ì§‘í•©

```
ğŸ“Â í”„ë¡œì„¸ìŠ¤ë“¤ì€ ê° íë“¤ì„ ì˜¤ê°€ë©° ìˆ˜í–‰ëœë‹¤.
```

## ìŠ¤ì¼€ì¤„ëŸ¬ (Scheduler)

- Long-term scheduler (ì¥ê¸° ìŠ¤ì¼€ì¤„ëŸ¬ or job scheduler)
    - ì‹œì‘ í”„ë¡œì„¸ìŠ¤ ì¤‘ ì–´ë–¤ ê²ƒë“¤ì„ ready queueë¡œ ë³´ë‚¼ì§€ ê²°ì •
    - í”„ë¡œì„¸ìŠ¤ì— memory(ë° ê°ì¢… ìì›)ì„ ì£¼ëŠ” ë¬¸ì œ
    - degree of Multiprogrammingì„ ì œì–´
    - time sharing systemì—ëŠ” ë³´í†µ ì¥ê¸° ìŠ¤ì¼€ì¤„ëŸ¬ê°€ ì—†ìŒ (ë¬´ì¡°ê±´ ready)
- Short-term scheduler (ë‹¨ê¸° ìŠ¤ì¼€ì¤„ëŸ¬ or CPU scheduler)
    - ì–´ë–¤ í”„ë¡œì„¸ìŠ¤ë¥¼ ë‹¤ìŒë²ˆì— running ì‹œí‚¬ì§€ ê²°ì •
    - í”„ë¡œì„¸ìŠ¤ì— CPUë¥¼ ì£¼ëŠ” ë¬¸ì œ
    - ì¶©ë¶„íˆ ë¹¨ë¼ì•¼ í•¨ (millisecond ë‹¨ìœ„)
- Medium-term scheduler (ì¤‘ê¸° ìŠ¤ì¼€ì¤„ëŸ¬ or Swapper)
    - ì—¬ìœ  ê³µê°„ ë§ˆë ¨ì„ ìœ„í•´ í”„ë¡œì„¸ìŠ¤ë¥¼ í†µì§¸ë¡œ ë©”ëª¨ë¦¬ì—ì„œ ë””ìŠ¤í¬ë¡œ ì«“ì•„ëƒ„ (swap ê³µê°„ìœ¼ë¡œ ì«“ì•„ëƒ„)
    - í”„ë¡œì„¸ìŠ¤ì—ê²Œì„œ memoryë¥¼ ëºëŠ” ë¬¸ì œ
    - degree of Multiprogramming ì„ ì œì–´

## í”„ë¡œì„¸ìŠ¤ ìƒíƒœ

- Running
    - CPUë¥¼ ì¡ê³  instructionì„ ìˆ˜í–‰ì¤‘ì¸ ìƒíƒœ
- Ready
    - CPUë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ìƒíƒœ(ë©”ëª¨ë¦¬ ë“± ë‹¤ë¥¸ ì¡°ê±´ì„ ëª¨ë‘ ë§Œì¡±í•˜ê³ )
- Blocked (wait, sleep)
    - I/O ë“±ì˜ eventë¥¼ (ìŠ¤ìŠ¤ë¡œ) ê¸°ë‹¤ë¦¬ëŠ” ìƒíƒœ
    - (ì˜ˆ) ë””ìŠ¤í¬ì—ì„œ fileì„ ì½ì–´ì™€ì•¼ í•˜ëŠ” ê²½ìš°
- Suspended (stopped)
    - ì™¸ë¶€ì ì¸ ì´ìœ (ex. ì¤‘ê¸° ìŠ¤ì¼€ì¤„ëŸ¬ì— ì˜í•´ì„œ ë©ˆì¶°ì§„ ê²½ìš°)ë¡œ í”„ë¡œì„¸ìŠ¤ì˜ ìˆ˜í–‰ì´ ì •ì§€ëœ ìƒíƒœ
    - í”„ë¡œì„¸ìŠ¤ëŠ” í†µì§¸ë¡œ ë””ìŠ¤í¬ì— swap out ëœë‹¤
    - ì•„ë¬´ ì¼ë„ í•˜ê³  ìˆì§€ ì•Šì€ ìƒíƒœ
    - (ì˜ˆ) ì‚¬ìš©ìê°€ í”„ë¡œê·¸ë¨ì„ ì¼ì‹œ ì •ì§€ì‹œí‚¨ ê²½ìš° (break key) ì‹œìŠ¤í…œì´ ì—¬ëŸ¬ ì´ìœ ë¡œ í”„ë¡œì„¸ìŠ¤ë¥¼ ì ì‹œ ì¤‘ë‹¨ì‹œí‚´ (ë©”ëª¨ë¦¬ì— ë„ˆë¬´ ë§ì€ í”„ë¡œì„¸ìŠ¤ê°€ ì˜¬ë¼ì™€ ìˆì„ ë•Œ)

```
Blocked : ìì‹ ì´ ìš”ì²­í•œ eventê°€ ë§Œì¡±ë˜ë©´ Ready
Suspended : ì™¸ë¶€ì—ì„œ resumeí•´ ì£¼ì–´ì•¼ Active
```

## í”„ë¡œì„¸ìŠ¤ ìƒíƒœë„ (ìì„¸í•œ ë²„ì „)

![Untitled9](image/6ê°•/Untitled7.png)

## Thread

> *A thread (or lightwight process) is a basic unit of CPU utilization*
> 
- Threadì˜ êµ¬ì„±
    
    ![Untitled](image/6ê°•/Untitled8.png)
    
    - Program counter
    - Register set
    - Stack space
- Threadê°€ ë™ë£Œ threadì™€ ê³µìœ í•˜ëŠ” ë¶€ë¶„(=task)
    - Code section
    - Data section
    - OS resources
- ì „í†µì ì¸ ê°œë…ì˜ Heavyweight processëŠ” í•˜ë‚˜ì˜ threadë¥¼ ê°€ì§€ê³  ìˆëŠ” taskë¡œ ë³¼ ìˆ˜ ìˆë‹¤.

## Multi-Thread ì‚¬ìš©ì‹œ ì¥ì 

- ë‹¤ì¤‘ ìŠ¤ë ˆë“œ(Multi-thread)ë¡œ êµ¬ì„±ëœ íƒœìŠ¤í¬ êµ¬ì¡°ì—ì„œëŠ” í•˜ë‚˜ì˜ ì„œë²„ ìŠ¤ë ˆë“œê°€ blocked(waiting) ìƒíƒœì¸ ë™ì•ˆì—ë„ ë™ì¼í•œ íƒœìŠ¤í¬ ë‚´ì˜ ë‹¤ë¥¸ ìŠ¤ë ˆë“œê°€ ì‹¤í–‰(running)ë˜ì–´ ë¹ ë¥¸ ì²˜ë¦¬ë¥¼ í•  ìˆ˜ ìˆë‹¤.
â†’ ex. ì›¹ì„œë²„(ë„¤ì´ë²„, ë‹¤ìŒ â€¦)ì—ì„œ ì‚¬ìš©ìê°€ ì›¹ì‚¬ì´íŠ¸ë¥¼ ë°©ë¬¸í•˜ê²Œ ë˜ë©´ HTML íŒ¨í‚·ì„ ì „ì†¡í•˜ê²Œ ë˜ëŠ”ë° ì´ë•Œ ì´ë¯¸ì§€ë‚˜ ì˜ìƒì„ ì²˜ë¦¬í•˜ëŠ” ìŠ¤ë ˆë“œì™€ í…ìŠ¤íŠ¸ë¥¼ ì²˜ë¦¬í•˜ëŠ” ìŠ¤ë ˆë“œê°€ ë”°ë¡œ ìˆì–´ì„œ í…ìŠ¤íŠ¸ë¥¼ ë¨¼ì € ì²˜ë¦¬í•˜ê³  ê³„ì† ì´ë¯¸ì§€ ìŠ¤ë ˆë“œì™€ ì˜ìƒ ìŠ¤ë ˆë“œë¥¼ ì²˜ë¦¬í•¨. ê·¸ë˜ì„œ ì‚¬ìš©ìëŠ” ì›¹ì„œë²„ì— ì ‘ì†ì„ í•˜ê²Œ ë˜ë©´ í…ìŠ¤íŠ¸ë¥¼ ë¨¼ì € ë³´ê³  ê·¸ ë‹¤ìŒì— í•˜ë‚˜ì”© ì´ë¯¸ì§€ì™€ ì˜ìƒì´ ë¡œë”©ë˜ëŠ” ê²½í—˜ì„ ê²ªìŒ.
- ë™ì¼í•œ ì¼ì„ ìˆ˜í–‰í•˜ëŠ” ë‹¤ì¤‘ ìŠ¤ë ˆë“œê°€ í˜‘ë ¥í•˜ì—¬ ë†’ì€ ì²˜ë¦¬ìœ¨(throughput)ê³¼ ì„±ëŠ¥ í–¥ìƒì„ ì–»ì„ ìˆ˜ ìˆë‹¤.
- ìŠ¤ë ˆë“œë¥¼ ì‚¬ìš©í•˜ë©´ ë³‘ë ¬ì„±ì„ ë†’ì¼ ìˆ˜ ìˆë‹¤.

![Untitled10](image/6ê°•/Untitled9.png)

## Benefits of Threads

- Responsiveness
    - ex. multi-threaded Web
- Resource Sharing
    - n threads can share binary code, data, resource of the process
- Economy
    - creating & CPU switching thread (rather than a process)
- Utilization of MP Architectures
    - each thread may be running in parallel on a different processor
